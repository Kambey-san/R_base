
R version 4.3.2 (2023-10-31 ucrt) -- "Eye Holes"
Copyright (C) 2023 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> setwd("C:/Users/Администратор/OneDrive/Документы/Alex/TEMP/Язык R для анализа данных/Урок 2. Обработка данных для анализа/00_HW")
> # Условие if-else
> library(cluster)
> head(votes.repub)
           X1856 X1860 X1864 X1868 X1872 X1876 X1880 X1884 X1888 X1892 X1896 X1900 X1904 X1908 X1912 X1916 X1920 X1924 X1928 X1932 X1936 X1940 X1944
Alabama       NA    NA    NA 51.44 53.19 40.02 36.98 38.44 32.28  3.95 28.13 34.67 20.65 24.38  8.26 21.97 30.98 27.01 48.49 14.15 12.82 14.34 18.20
Alaska        NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
Arizona       NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA 12.74 35.37 55.41 41.26 57.57 30.53 26.93 36.01 40.90
Arkansas      NA    NA    NA 53.73 52.17 39.88 39.55 40.50 38.07 32.01 25.11 35.04 40.25 37.31 19.73 28.01 38.73 29.28 39.33 12.91 17.86 20.87 29.84
California 18.77 32.96 58.63 50.24 56.38 50.88 48.92 52.08 49.95 43.76 49.13 54.48 61.90 55.46  0.58 46.26 66.24 57.21 64.70 37.40 31.70 41.35 42.99
Colorado      NA    NA    NA    NA    NA    NA 51.28 54.39 55.31 41.13 13.84 42.04 55.27 46.88 21.88 34.75 59.32 57.02 64.72 41.43 37.09 50.92 53.21
           X1948 X1952 X1956 X1960 X1964 X1968 X1972 X1976
Alabama    19.04 35.02 39.39 41.75  69.5  14.0  72.4 43.48
Alaska        NA    NA    NA 50.94  34.1  45.3  58.1 62.91
Arizona    43.82 58.35 60.99 55.52  50.4  54.8  64.7 58.62
Arkansas   21.02 43.76 45.82 43.06  43.9  30.8  68.9 34.97
California 47.14 56.39 55.40 50.10  40.9  47.8  55.0 50.89
Colorado   46.52 60.27 59.49 54.63  38.7  50.5  62.6 55.89
> colMeans(votes.repub)
  X1856   X1860   X1864   X1868   X1872   X1876   X1880   X1884   X1888   X1892   X1896   X1900   X1904   X1908   X1912   X1916   X1920   X1924 
     NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA 
  X1928   X1932   X1936   X1940   X1944   X1948   X1952   X1956   X1960   X1964   X1968   X1972   X1976 
     NA      NA      NA      NA      NA      NA      NA      NA 49.9446 41.1360 44.1260 62.7060 50.1034 
> if (mean(votes.repub[,30], na.rm = TRUE) > 60) {
+   print("Республиканцы набрали высокий процент голосов")
+ } else {
+   print("Республиканцы набрали < 60% голосов")
+ }
[1] "Республиканцы набрали высокий процент голосов"
> if (mean(votes.repub[,1], na.rm = TRUE) > 60) {
+   print("Республиканцы набрали высокий процент голосов")
+ } else {
+   print("Республиканцы набрали < 60% голосов")
+ }
[1] "Республиканцы набрали < 60% голосов"
> ifelse(x != 0, "Yes", "No")
Error: object 'x' not found
> # Есть похожая функция ifelse()
> x <- c(1, 0, 0, 0, 1, 0)
> ifelse(x != 0, "Yes", "No")
[1] "Yes" "No"  "No"  "No"  "Yes" "No" 
> ifelse(
+   colMeans(votes.repub, na.rm = TRUE) > 60,
+   "Республиканцы набрали высокий процент голосов",
+   "Республиканцы набрали < 60% голосов"
+ )
                                          X1856                                           X1860                                           X1864 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1868                                           X1872                                           X1876 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1880                                           X1884                                           X1888 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1892                                           X1896                                           X1900 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1904                                           X1908                                           X1912 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1916                                           X1920                                           X1924 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1928                                           X1932                                           X1936 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1940                                           X1944                                           X1948 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1952                                           X1956                                           X1960 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" 
                                          X1964                                           X1968                                           X1972 
          "Республиканцы набрали < 60% голосов"           "Республиканцы набрали < 60% голосов" "Республиканцы набрали высокий процент голосов" 
                                          X1976 
          "Республиканцы набрали < 60% голосов" 
> date_list <- c(rep("2018-01-01", 4), rep("2018-01-05", 6))
> ball_list <- c(rep(1, 3), rep(3, 4), rep(5, 3))
> price_list <- c(rep(90, 3), rep(150, 4), rep(390, 3))
> df <- data.frame("date"=date_list, "ball"=ball_list, "price"=price_list)
> head(df, 10)
         date ball price
1  2018-01-01    1    90
2  2018-01-01    1    90
3  2018-01-01    1    90
4  2018-01-01    3   150
5  2018-01-05    3   150
6  2018-01-05    3   150
7  2018-01-05    3   150
8  2018-01-05    5   390
9  2018-01-05    5   390
10 2018-01-05    5   390
> # Сохраним датасет в файл
> write.csv(df, "df.csv", row.names=FALSE)
> # Загрузим датасет из файла
> df <- read.csv("df.csv", header=TRUE, sep=",")
> head(df, 10)
         date ball price
1  2018-01-01    1    90
2  2018-01-01    1    90
3  2018-01-01    1    90
4  2018-01-01    3   150
5  2018-01-05    3   150
6  2018-01-05    3   150
7  2018-01-05    3   150
8  2018-01-05    5   390
9  2018-01-05    5   390
10 2018-01-05    5   390
> str(df)
'data.frame':	10 obs. of  3 variables:
 $ date : chr  "2018-01-01" "2018-01-01" "2018-01-01" "2018-01-01" ...
 $ ball : int  1 1 1 3 3 3 3 5 5 5
 $ price: int  90 90 90 150 150 150 150 390 390 390
> unique(df$ball)
[1] 1 3 5
> unique(df$price)
[1]  90 150 390
> # Для работы с датами загружаем пакет "lubridate"
> library(lubridate)
Error in library(lubridate) : there is no package called ‘lubridate’
> # Для работы с датами загружаем пакет "lubridate"
> install.packages("lubridate")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
Installing package into ‘C:/Users/Администратор/AppData/Local/R/win-library/4.3’
(as ‘lib’ is unspecified)
also installing the dependencies ‘cpp11’, ‘generics’, ‘timechange’

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/cpp11_0.4.7.zip'
Content type 'application/zip' length 303970 bytes (296 KB)
downloaded 296 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/generics_0.1.3.zip'
Content type 'application/zip' length 80045 bytes (78 KB)
downloaded 78 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/timechange_0.3.0.zip'
Content type 'application/zip' length 507737 bytes (495 KB)
downloaded 495 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/lubridate_1.9.3.zip'
Content type 'application/zip' length 985164 bytes (962 KB)
downloaded 962 KB

package ‘cpp11’ successfully unpacked and MD5 sums checked
package ‘generics’ successfully unpacked and MD5 sums checked
package ‘timechange’ successfully unpacked and MD5 sums checked
package ‘lubridate’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\Администратор\AppData\Local\Temp\Rtmp2pwjhC\downloaded_packages
> library(lubridate)

Attaching package: ‘lubridate’

The following objects are masked from ‘package:base’:

    date, intersect, setdiff, union

> class(df$date)
[1] "character"
> dayn = ymd(df$date)
> dayn
 [1] "2018-01-01" "2018-01-01" "2018-01-01" "2018-01-01" "2018-01-05" "2018-01-05" "2018-01-05" "2018-01-05" "2018-01-05" "2018-01-05"
> # Напишем функцию, которая считает, на какую сумму продано мячей за определенный день
> # Поскольку дни в месяцах совпадают, нам нужна функция с аргументами, например, месяц и день
> sum_balls <- function(dataset, m, d) {
+   sum(dataset$price[month(dataset$date) == m & day(dataset$date) == d])
+ }
> sum_balls(df, 1, 1)
[1] 420
> # Используем цикл for, чтобы вывести сумму за определенный день
> for (i in 1:5) {
+   print(sum_balls(df, 1, i))
+ }
[1] 420
[1] 0
[1] 0
[1] 0
[1] 1620
> # Функции lapply() и sapply()
> head(lapply(votes.repub, sum))
$X1856
[1] NA

$X1860
[1] NA

$X1864
[1] NA

$X1868
[1] NA

$X1872
[1] NA

$X1876
[1] NA

> sapply(votes.repub, sum)
  X1856   X1860   X1864   X1868   X1872   X1876   X1880   X1884   X1888   X1892   X1896   X1900   X1904   X1908   X1912   X1916   X1920   X1924   X1928 
     NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA 
  X1932   X1936   X1940   X1944   X1948   X1952   X1956   X1960   X1964   X1968   X1972   X1976 
     NA      NA      NA      NA      NA      NA      NA 2497.23 2056.80 2206.30 3135.30 2505.17 
> # tapply()
> l <- function(x) {
+   diff(range(x))
+ }
> tapply(Orange$circumference, Orange$Tree, l)
  3   1   5   2   4 
110 115 147 170 182 
> search()
 [1] ".GlobalEnv"        "package:lubridate" "package:cluster"   "tools:rstudio"     "package:stats"     "package:graphics"  "package:grDevices"
 [8] "package:utils"     "package:datasets"  "package:methods"   "Autoloads"         "package:base"     
> # С помощью :: показываем R, из какого пакета нам нужна функция
> lubridate::dmy("01/01/1970")
[1] "1970-01-01"
> plot(
+   xs, ys, pch='.',
+   col=ifelse(in.circle, "blue", "grey"),
+   xlab='', ylab='', asp=1,
+   main=paste("MC Approximation of Pi =", mc.pi)
+ )
Error: object 'xs' not found
> # runif samples from a uniform distribution
> xs <- runif(runs, min=-0.5, max=0.5)
Error: object 'runs' not found
> ys <- runif(runs, min=-0.5, max=0.5)
Error: object 'runs' not found
> in.circle <- xs^2 + ys^2 <= 0.5^2
Error: object 'xs' not found
> mc.pi <- (sum(in.circle)/runs)*4
Error: object 'in.circle' not found
> plot(
+   xs, ys, pch='.',
+   col=ifelse(in.circle, "blue", "grey"),
+   xlab='', ylab='', asp=1,
+   main=paste("MC Approximation of Pi =", mc.pi)
+ )
Error: object 'xs' not found
> 
> # Метод Монте-Карло
> runs <- 100000
> # runif samples from a uniform distribution
> xs <- runif(runs, min=-0.5, max=0.5)
> ys <- runif(runs, min=-0.5, max=0.5)
> in.circle <- xs^2 + ys^2 <= 0.5^2
> mc.pi <- (sum(in.circle)/runs)*4
> plot(
+   xs, ys, pch='.',
+   col=ifelse(in.circle, "blue", "grey"),
+   xlab='', ylab='', asp=1,
+   main=paste("MC Approximation of Pi =", mc.pi)
+ )
> # Пакет "dplyr" и оператор pipe
> install.packages("dplyr")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
Installing package into ‘C:/Users/Администратор/AppData/Local/R/win-library/4.3’
(as ‘lib’ is unspecified)
also installing the dependencies ‘fansi’, ‘utf8’, ‘pkgconfig’, ‘withr’, ‘pillar’, ‘tibble’, ‘tidyselect’

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/fansi_1.0.6.zip'
Content type 'application/zip' length 313879 bytes (306 KB)
downloaded 306 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/utf8_1.2.4.zip'
Content type 'application/zip' length 149739 bytes (146 KB)
downloaded 146 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/pkgconfig_2.0.3.zip'
Content type 'application/zip' length 22375 bytes (21 KB)
downloaded 21 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/withr_3.0.0.zip'
Content type 'application/zip' length 246056 bytes (240 KB)
downloaded 240 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/pillar_1.9.0.zip'
Content type 'application/zip' length 659511 bytes (644 KB)
downloaded 644 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/tibble_3.2.1.zip'
Content type 'application/zip' length 690677 bytes (674 KB)
downloaded 674 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/tidyselect_1.2.0.zip'
Content type 'application/zip' length 224126 bytes (218 KB)
downloaded 218 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/dplyr_1.1.4.zip'
Content type 'application/zip' length 1559174 bytes (1.5 MB)
downloaded 1.5 MB

package ‘fansi’ successfully unpacked and MD5 sums checked
package ‘utf8’ successfully unpacked and MD5 sums checked
package ‘pkgconfig’ successfully unpacked and MD5 sums checked
package ‘withr’ successfully unpacked and MD5 sums checked
package ‘pillar’ successfully unpacked and MD5 sums checked
package ‘tibble’ successfully unpacked and MD5 sums checked
package ‘tidyselect’ successfully unpacked and MD5 sums checked
package ‘dplyr’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\Администратор\AppData\Local\Temp\Rtmp2pwjhC\downloaded_packages
> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> iris %>% dim
[1] 150   5
> head(iris %>% filter(Species=="versicolor"))
  Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
1          7.0         3.2          4.7         1.4 versicolor
2          6.4         3.2          4.5         1.5 versicolor
3          6.9         3.1          4.9         1.5 versicolor
4          5.5         2.3          4.0         1.3 versicolor
5          6.5         2.8          4.6         1.5 versicolor
6          5.7         2.8          4.5         1.3 versicolor
> head(iris %>% filter(Species=="versicolor") %>% select(Petal.Length))
  Petal.Length
1          4.7
2          4.5
3          4.9
4          4.0
5          4.6
6          4.5
> vc <- as.numeric(iris %>% filter(Species=="versicolor") %>% select(Petal.Length) %>% unlist)
> vc
 [1] 4.7 4.5 4.9 4.0 4.6 4.5 4.7 3.3 4.6 3.9 3.5 4.2 4.0 4.7 3.6 4.4 4.5 4.1 4.5 3.9 4.8 4.0 4.9 4.7 4.3 4.4 4.8 5.0 4.5 3.5 3.8 3.7 3.9
[34] 5.1 4.5 4.5 4.7 4.4 4.1 4.0 4.4 4.6 4.0 3.3 4.2 4.2 4.2 4.3 3.0 4.1
> # найдем длину лепестков , только для "virginica". И с помощью оператора %in% посмотрим, 
> # сколько совпадений в длине лепестков двух разных видов цветка
> vg <- as.numeric(iris %>% filter (Species=="virginica") %>% select(Petal.Length) %>% unlist)
> vg
 [1] 6.0 5.1 5.9 5.6 5.8 6.6 4.5 6.3 5.8 6.1 5.1 5.3 5.5 5.0 5.1 5.3 5.5 6.7 6.9 5.0 5.7 4.9 6.7 4.9 5.7 6.0 4.8 4.9 5.6 5.8 6.1 6.4 5.6
[34] 5.1 5.6 6.1 5.6 5.5 4.8 5.4 5.6 5.1 5.1 5.9 5.7 5.2 5.0 5.2 5.4 5.1
> vc %in% vg
 [1] FALSE  TRUE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE
[23]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[45] FALSE FALSE FALSE FALSE FALSE FALSE
> sum(vc %in% vg)
[1] 13
> # Сохраняем набор данных в формате CSV
> a <- c(1, 2, 3)
> b <- c(0, 0, 0)
> nm <- c("1_row", "2_row", "3_row")
> df <- data.frame(a, b)
> df
  a b
1 1 0
2 2 0
3 3 0
> df["rownames"] = nm
> df
  a b rownames
1 1 0    1_row
2 2 0    2_row
3 3 0    3_row
> df <- df[c("rownames", "a", "b")]
> df
  rownames a b
1    1_row 1 0
2    2_row 2 0
3    3_row 3 0
> filename <- "new_dataframe.csv"
> write.csv(df, file=filename)
> # Аргументы функции read.csv()
> read.csv(filename)
  X rownames a b
1 1    1_row 1 0
2 2    2_row 2 0
3 3    3_row 3 0
> read.csv(filename, sep=";")
  X.rownames.a.b
1    1,1_row,1,0
2    2,2_row,2,0
3    3,3_row,3,0
> read.csv(filename, sep=",", nrows=5, row.names=1)
  rownames a b
1    1_row 1 0
2    2_row 2 0
3    3_row 3 0
> read.csv(filename, sep=",", nrows=5, header=FALSE)
  V1       V2 V3 V4
1 NA rownames  a  b
2  1    1_row  1  0
3  2    2_row  2  0
4  3    3_row  3  0
> # Работа с Excel файлами
> install.packages("readxl")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
Installing package into ‘C:/Users/Администратор/AppData/Local/R/win-library/4.3’
(as ‘lib’ is unspecified)
also installing the dependencies ‘rematch’, ‘crayon’, ‘hms’, ‘prettyunits’, ‘cellranger’, ‘progress’

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/rematch_2.0.0.zip'
Content type 'application/zip' length 19011 bytes (18 KB)
downloaded 18 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/crayon_1.5.2.zip'
Content type 'application/zip' length 162336 bytes (158 KB)
downloaded 158 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/hms_1.1.3.zip'
Content type 'application/zip' length 104296 bytes (101 KB)
downloaded 101 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/prettyunits_1.2.0.zip'
Content type 'application/zip' length 157787 bytes (154 KB)
downloaded 154 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/cellranger_1.1.0.zip'
Content type 'application/zip' length 103631 bytes (101 KB)
downloaded 101 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/progress_1.2.3.zip'
Content type 'application/zip' length 87813 bytes (85 KB)
downloaded 85 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/readxl_1.4.3.zip'
Content type 'application/zip' length 1197241 bytes (1.1 MB)
downloaded 1.1 MB

package ‘rematch’ successfully unpacked and MD5 sums checked
package ‘crayon’ successfully unpacked and MD5 sums checked
package ‘hms’ successfully unpacked and MD5 sums checked
package ‘prettyunits’ successfully unpacked and MD5 sums checked
package ‘cellranger’ successfully unpacked and MD5 sums checked
package ‘progress’ successfully unpacked and MD5 sums checked
package ‘readxl’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\Администратор\AppData\Local\Temp\Rtmp2pwjhC\downloaded_packages
> library(readxl)
> library(httr)
Error in library(httr) : there is no package called ‘httr’
> # Скачаем файл "Financial Sample.xlsx"
> filename <- "Financial Sample.xlsx"
> url <- "https://go.microsoft.com/fwlink/?LinkID=521962"
> GET(url, write_disk(filename, overwrite=TRUE))
Error in GET(url, write_disk(filename, overwrite = TRUE)) : 
  could not find function "GET"
> url <- "https://go.microsoft.com/fwlink/?LinkID=521962"
> GET(url, write_disk(filename, overwrite=TRUE))
Error in GET(url, write_disk(filename, overwrite = TRUE)) : 
  could not find function "GET"
> head(readxl::read_excel(filename))
Error: `path` does not exist: ‘Financial Sample.xlsx’
> # Работа с Excel файлами
> install.packages("readxl")
Error in install.packages : Updating loaded packages

Restarting R session...

> install.packages("readxl")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
Installing package into ‘C:/Users/Администратор/AppData/Local/R/win-library/4.3’
(as ‘lib’ is unspecified)
trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/readxl_1.4.3.zip'
Content type 'application/zip' length 1197241 bytes (1.1 MB)
downloaded 1.1 MB

package ‘readxl’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\Администратор\AppData\Local\Temp\RtmpMbXoCO\downloaded_packages
> install.packages("httr")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
Installing package into ‘C:/Users/Администратор/AppData/Local/R/win-library/4.3’
(as ‘lib’ is unspecified)
also installing the dependencies ‘sys’, ‘askpass’, ‘curl’, ‘openssl’

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/sys_3.4.2.zip'
Content type 'application/zip' length 47110 bytes (46 KB)
downloaded 46 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/askpass_1.2.0.zip'
Content type 'application/zip' length 74898 bytes (73 KB)
downloaded 73 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/curl_5.2.0.zip'
Content type 'application/zip' length 3217113 bytes (3.1 MB)
downloaded 3.1 MB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/openssl_2.1.1.zip'
Content type 'application/zip' length 3186655 bytes (3.0 MB)
downloaded 3.0 MB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/httr_1.4.7.zip'
Content type 'application/zip' length 486168 bytes (474 KB)
downloaded 474 KB

package ‘sys’ successfully unpacked and MD5 sums checked
package ‘askpass’ successfully unpacked and MD5 sums checked
package ‘curl’ successfully unpacked and MD5 sums checked
package ‘openssl’ successfully unpacked and MD5 sums checked
package ‘httr’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\Администратор\AppData\Local\Temp\RtmpMbXoCO\downloaded_packages
> library(readxl)
> library(httr)
> # Скачаем файл "Financial Sample.xlsx"
> filename <- "Financial Sample.xlsx"
> url <- "https://go.microsoft.com/fwlink/?LinkID=521962"
> download_path <- "Financial Sample.xlsx"
> GET(url, write_disk(filename, overwrite=TRUE))
Response [https://download.microsoft.com/download/1/4/E/14EDED28-6C58-4055-A65C-23B4DA81C4DE/Financial%20Sample.xlsx]
  Date: 2024-02-21 12:16
  Status: 200
  Content-Type: application/octet-stream
  Size: 83.4 kB
<ON DISK>  C:\Users\Администратор\OneDrive\Документы\Alex\TEMP\Язык R для анализа данных\Урок 2. Обработка данных для анализа\00_HW\Financial Sample.xlsx
> head(readxl::read_excel(filename))
# A tibble: 6 × 16
  Segment    Country Product  `Discount Band` `Units Sold` `Manufacturing Price` `Sale Price` `Gross Sales` Discounts  Sales   COGS Profit
  <chr>      <chr>   <chr>    <chr>                  <dbl>                 <dbl>        <dbl>         <dbl>     <dbl>  <dbl>  <dbl>  <dbl>
1 Government Canada  Carrete… None                   1618.                     3           20         32370         0  32370  16185  16185
2 Government Germany Carrete… None                   1321                      3           20         26420         0  26420  13210  13210
3 Midmarket  France  Carrete… None                   2178                      3           15         32670         0  32670  21780  10890
4 Midmarket  Germany Carrete… None                    888                      3           15         13320         0  13320   8880   4440
5 Midmarket  Mexico  Carrete… None                   2470                      3           15         37050         0  37050  24700  12350
6 Government Germany Carrete… None                   1513                      3          350        529550         0 529550 393380 136170
# ℹ 4 more variables: Date <dttm>, `Month Number` <dbl>, `Month Name` <chr>, Year <chr>
> # Импорт данных, взятых из интернет-ресурса и их обработка
> install.packages("rvest")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
Installing package into ‘C:/Users/Администратор/AppData/Local/R/win-library/4.3’
(as ‘lib’ is unspecified)
also installing the dependencies ‘selectr’, ‘xml2’

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/selectr_0.4-2.zip'
Content type 'application/zip' length 492358 bytes (480 KB)
downloaded 480 KB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/xml2_1.3.6.zip'
Content type 'application/zip' length 1608907 bytes (1.5 MB)
downloaded 1.5 MB

trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/rvest_1.0.4.zip'
Content type 'application/zip' length 304876 bytes (297 KB)
downloaded 297 KB

package ‘selectr’ successfully unpacked and MD5 sums checked
package ‘xml2’ successfully unpacked and MD5 sums checked
package ‘rvest’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\Администратор\AppData\Local\Temp\RtmpMbXoCO\downloaded_packages
> library(rvest)
> url1 <- paste0("https://cdas.cancer.gov/datasets/nlst/")
> url1
[1] "https://cdas.cancer.gov/datasets/nlst/"
> page <- read_html(url1)
> page
{html_document}
<html lang="en">
[1] <head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8">\n<meta http-equiv="X-UA-Compatible" content="IE=edge,ch ...
[2] <body class="">\n        <a href="#maincontent" class="sr-only sr-only-focusable skipnav">Skip to Main Content</a>\n\n        \n    ...
> tabl <- page %>% html_nodes("table")
> tabl
{xml_nodeset (2)}
[1] <table class="table table-striped table-bordered">\n<tr>\n<td class="nowrap vertical-middle">\n                \n\n\n    \n    \n   ...
[2] <table class="table table-striped table-bordered" style="width: auto; min-width: 50%;"><tr>\n<td>\n                <b>For NLST:</b> ...
> tabl <- tabl[[1]] %>% html_table
> head(tabl)
# A tibble: 6 × 2
  X1                                                            X2                                                                        
  <chr>                                                         <chr>                                                                     
1 "Data Dictionary\n            \n            (PDF - 382.2 KB)" "1.\n                \n                \n                    The Particip…
2 "Data Dictionary\n            \n            (PDF - 82.7 KB)"  "2.\n                \n                \n                    The Spiral C…
3 "Data Dictionary\n            \n            (PDF - 75.5 KB)"  "3.\n                \n                \n                    The Chest X-…
4 "Data Dictionary\n            \n            (PDF - 53.6 KB)"  "4.\n                \n                \n                    The Spiral C…
5 "Data Dictionary\n            \n            (PDF - 50.5 KB)"  "5.\n                \n                \n                    The Chest X-…
6 "Data Dictionary\n            \n            (PDF - 51.0 KB)"  "6.\n                \n                \n                    The Spiral C…
> tabl <- tabl %>% setNames(c("data", "description"))
> head(tabl, 3)
# A tibble: 3 × 2
  data                                                          description                                                               
  <chr>                                                         <chr>                                                                     
1 "Data Dictionary\n            \n            (PDF - 382.2 KB)" "1.\n                \n                \n                    The Particip…
2 "Data Dictionary\n            \n            (PDF - 82.7 KB)"  "2.\n                \n                \n                    The Spiral C…
3 "Data Dictionary\n            \n            (PDF - 75.5 KB)"  "3.\n                \n                \n                    The Chest X-…
> # Рассмотрим отдельный столбец датафрейма
> head(tabl["description"])
# A tibble: 6 × 1
  description                                                                                                                             
  <chr>                                                                                                                                   
1 "1.\n                \n                \n                    The Participant dataset is a comprehensive dataset that contains all the N…
2 "2.\n                \n                \n                    The Spiral CT Screening dataset (~75,100, one record per CT screen) contai…
3 "3.\n                \n                \n                    The Chest X-Ray Screening dataset (~73,500, one record per X-Ray screen) c…
4 "4.\n                \n                \n                    The Spiral CT Abnormalities dataset (~177,500, one record per abnormality …
5 "5.\n                \n                \n                    The Chest X-Ray Abnormalities dataset (~47,200, one record per abnormality…
6 "6.\n                \n                \n                    The Spiral CT Comparison Read Abnormalities dataset (~31,000, one record p…
> library(stringr)
> install.packages("stringr")
Error in install.packages : Updating loaded packages
> # install.packages("stringr")
> library(stringr)
> head(desc_new)
Error: object 'desc_new' not found
> install.packages("stringr")
Error in install.packages : Updating loaded packages

Restarting R session...

> install.packages("stringr")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
Installing package into ‘C:/Users/Администратор/AppData/Local/R/win-library/4.3’
(as ‘lib’ is unspecified)
trying URL 'https://cran.rstudio.com/bin/windows/contrib/4.3/stringr_1.5.1.zip'
Content type 'application/zip' length 319132 bytes (311 KB)
downloaded 311 KB

package ‘stringr’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\Администратор\AppData\Local\Temp\RtmpOqeBVw\downloaded_packages
> library(stringr)
> desc_new <- stringr::str_replace(tabl$description, "\\d*.", "")
> head(desc_new)
[1] "\n                \n                \n                    The Participant dataset is a comprehensive dataset that contains all the NLST study data needed for most analyses of lung cancer screening, incidence, and mortality.  The dataset contains one record for each of the ~53,500 participants in NLST."                                                                                                                                       
[2] "\n                \n                \n                    The Spiral CT Screening dataset (~75,100, one record per CT screen) contains information from the Spiral CT screening exams. This includes technical parameters, reconstruction filter(s), reader ID, and recommendations for diagnostic follow-up."                                                                                                                                        
[3] "\n                \n                \n                    The Chest X-Ray Screening dataset (~73,500, one record per X-Ray screen) contains information from the Chest X-Ray screening exams. This includes technical parameters, reader ID, and recommendations for diagnostic follow-up."                                                                                                                                                           
[4] "\n                \n                \n                    The Spiral CT Abnormalities dataset (~177,500, one record per abnormality on CT) contains information about each abnormality observed on the Spiral CT screening exams."                                                                                                                                                                                                                    
[5] "\n                \n                \n                    The Chest X-Ray Abnormalities dataset (~47,200, one record per abnormality on X-Ray) contains information about each abnormality observed on the Chest X-Ray screening exams."                                                                                                                                                                                                              
[6] "\n                \n                \n                    The Spiral CT Comparison Read Abnormalities dataset (~31,000, one record per abnormality on CT) contains information about two types of abnormalities observed on the comparison read of CT exams: (a) all non-calcified nodules / masses >= 4mm in diameter; (b) other abnormalities deemed significant by the radiologist. Information about change in size and attenuation is available."
> desc_new <- gsub("\n", "", desc_new)
> desc_new <- trimws(desc_new)
> head(desc_new)
[1] "The Participant dataset is a comprehensive dataset that contains all the NLST study data needed for most analyses of lung cancer screening, incidence, and mortality.  The dataset contains one record for each of the ~53,500 participants in NLST."                                                                                                                                       
[2] "The Spiral CT Screening dataset (~75,100, one record per CT screen) contains information from the Spiral CT screening exams. This includes technical parameters, reconstruction filter(s), reader ID, and recommendations for diagnostic follow-up."                                                                                                                                        
[3] "The Chest X-Ray Screening dataset (~73,500, one record per X-Ray screen) contains information from the Chest X-Ray screening exams. This includes technical parameters, reader ID, and recommendations for diagnostic follow-up."                                                                                                                                                           
[4] "The Spiral CT Abnormalities dataset (~177,500, one record per abnormality on CT) contains information about each abnormality observed on the Spiral CT screening exams."                                                                                                                                                                                                                    
[5] "The Chest X-Ray Abnormalities dataset (~47,200, one record per abnormality on X-Ray) contains information about each abnormality observed on the Chest X-Ray screening exams."                                                                                                                                                                                                              
[6] "The Spiral CT Comparison Read Abnormalities dataset (~31,000, one record per abnormality on CT) contains information about two types of abnormalities observed on the comparison read of CT exams: (a) all non-calcified nodules / masses >= 4mm in diameter; (b) other abnormalities deemed significant by the radiologist. Information about change in size and attenuation is available."
> # Сохраним обработанные данные в наш датафрейм
> tabl["description"] = desc_new
> dplyr::tibble(tabl)
# A tibble: 17 × 2
   data                                                          description                                                              
   <chr>                                                         <chr>                                                                    
 1 "Data Dictionary\n            \n            (PDF - 382.2 KB)" The Participant dataset is a comprehensive dataset that contains all the…
 2 "Data Dictionary\n            \n            (PDF - 82.7 KB)"  The Spiral CT Screening dataset (~75,100, one record per CT screen) cont…
 3 "Data Dictionary\n            \n            (PDF - 75.5 KB)"  The Chest X-Ray Screening dataset (~73,500, one record per X-Ray screen)…
 4 "Data Dictionary\n            \n            (PDF - 53.6 KB)"  The Spiral CT Abnormalities dataset (~177,500, one record per abnormalit…
 5 "Data Dictionary\n            \n            (PDF - 50.5 KB)"  The Chest X-Ray Abnormalities dataset (~47,200, one record per abnormali…
 6 "Data Dictionary\n            \n            (PDF - 51.0 KB)"  The Spiral CT Comparison Read Abnormalities dataset (~31,000, one record…
 7 "Data Dictionary\n            \n            (PDF - 51.0 KB)"  The Chest X-Ray Comparison Read Abnormalities dataset (~5,200, one recor…
 8 "Data Dictionary\n            \n            (PDF - 52.4 KB)"  The Diagnostic Procedures dataset (~60,900, one record per diagnostic pr…
 9 "Data Dictionary\n            \n            (PDF - 52.9 KB)"  The Medical Complications dataset (~800, one record per medical complica…
10 "Data Dictionary\n            \n            (PDF - 87.4 KB)"  The Lung Cancer dataset (~2,100, one record per lung cancer) contains in…
11 "Data Dictionary\n            \n            (PDF - 47.8 KB)"  The Treatment dataset (~4,600, one record per treatment procedure) conta…
12 "Data Dictionary\n            \n            (PDF - 43.7 KB)"  The Cause of Death dataset (~15,200, one record per cause of death/other…
13 "Data Dictionary\n            \n            (PDF - 42.6 KB)"  The LSS Non-cancer Condition dataset (~10,900, one record per condition)…
14 "Data Dictionary\n            \n            (PDF - 43.0 KB)"  The ACRIN Non-lung-cancer Condition dataset (~3,400, one record per cond…
15 "Data Dictionary\n            \n            (PDF - 67.8 KB)"  The LSS HAQ dataset (~3,200, one record per survey form) contains data f…
16 "Data Dictionary\n            \n            (PDF - 79.0 KB)"  The Spiral CT Image Information dataset (~203,000, one record per SCT im…
17 "Data Dictionary\n            \n            (PDF - 98.9 KB)"  The Pathology Image dataset (~1,250, one record per pathology image) con…
> 